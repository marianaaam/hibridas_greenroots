<app-menu></app-menu>

<ion-content [fullscreen]="true" class="productos-content">
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title>Productos Ecológicos</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="content-container">
    <!-- Barra de Búsqueda -->
    <ion-toolbar class="search-toolbar">
      <ion-searchbar
        [(ngModel)]="terminoBusqueda"
        (ionInput)="buscarProductos()"
        (ionClear)="limpiarBusqueda()"
        placeholder="Buscar productos por nombre, descripción o categoría..."
        debounce="300"
        color="light">
      </ion-searchbar>
    </ion-toolbar>

    <!-- Filtros de Categoría -->
    <div class="filtros-categorias">
      <ion-button size="small" fill="outline" [color]="categoriaSeleccionada === 'todos' ? 'success' : 'medium'" (click)="filtrarProductos('todos')">
        Todos
      </ion-button>
      <ion-button *ngFor="let cat of categorias" size="small" fill="outline" [color]="categoriaSeleccionada === cat ? 'success' : 'medium'" (click)="filtrarProductos(cat)">
        {{ cat | titlecase }}
      </ion-button>
    </div>

    <!-- Información de resultados -->
    <div *ngIf="!isLoading" class="resultados-info">
      <ion-text color="medium">
        <small>
          {{ productosFiltrados.length }} producto(s) encontrado(s)
          <span *ngIf="terminoBusqueda">para "{{ terminoBusqueda }}"</span>
          <span *ngIf="categoriaSeleccionada !== 'todos'">en {{ categoriaSeleccionada | titlecase }}</span>
        </small>
      </ion-text>
    </div>

    <div *ngIf="isLoading" class="loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando productos...</p>
    </div>

    <!-- Grid de Productos -->
    <div *ngIf="!isLoading" class="productos-grid">
      <ion-card 
        *ngFor="let producto of productosFiltrados" 
        class="producto-card" 
        [class.destacado]="producto.destacado"
        [class.stock-bajo]="producto.stock > 0 && producto.stock <= 5"
        [class.sin-stock]="producto.stock === 0">
        
        <div class="producto-imagen-container">
          <img [src]="producto.imagen" [alt]="producto.nombre" class="producto-imagen" />
          <ion-badge *ngIf="producto.destacado" color="success" class="badge-destacado">Destacado</ion-badge>
          <ion-badge class="badge-stock">
            {{ producto.stock === 0 ? 'Sin Stock' : (producto.stock <= 5 ? 'Stock Bajo' : 'Stock: ' + producto.stock) }}
          </ion-badge>
        </div>

        <ion-card-header>
          <ion-card-title class="producto-nombre">{{ producto.nombre }}</ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <p class="producto-descripcion">{{ producto.descripcion }}</p>
          
          <div class="producto-info">
            <div class="producto-precio">
              $ {{ producto.precio | number:'1.0-0' }}
            </div>
            <div class="producto-categoria">
              {{ producto.categoria | titlecase }}
            </div>
          </div>

          <!-- Acciones de administración -->
          <div class="admin-actions" *ngIf="producto.stock > 0">
            <ion-button expand="block" color="primary" size="small" (click)="reducirStock(producto.id, 1)">
              <ion-icon slot="start" name="cart-outline"></ion-icon>
              Comprar
            </ion-button>
          </div>

          <div class="admin-actions" *ngIf="producto.stock === 0">
            <ion-button expand="block" color="medium" size="small" disabled>
              <ion-icon slot="start" name="alert-circle-outline"></ion-icon>
              Sin Stock
            </ion-button>
          </div>

          <!-- Botones de gestión -->
          <div class="gestion-actions">
            <ion-button fill="clear" color="danger" size="small" (click)="confirmarEliminacion(producto)">
              <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="warning" size="small" (click)="reducirStock(producto.id, 1)">
              <ion-icon slot="icon-only" name="remove-circle-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="success" size="small" (click)="aumentarStock(producto.id, 5)">
              <ion-icon slot="icon-only" name="add-circle-outline"></ion-icon>
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Estado vacío -->
    <div *ngIf="!isLoading && productosFiltrados.length === 0 && productos.length > 0" class="empty-state">
      <ion-icon name="search-outline" class="empty-icon"></ion-icon>
      <h3>No se encontraron productos</h3>
      <p>Intenta con otros términos de búsqueda o categorías.</p>
      <ion-button fill="outline" (click)="limpiarBusqueda()">
        <ion-icon slot="start" name="refresh-outline"></ion-icon>
        Mostrar todos
      </ion-button>
    </div>

    <div *ngIf="!isLoading && productos.length === 0" class="empty-state">
      <ion-icon name="leaf-outline" class="empty-icon"></ion-icon>
      <h3>No hay productos disponibles</h3>
      <p>Pronto tendremos nuevos productos ecológicos para ti.</p>
    </div>
  </div>
</ion-content>  